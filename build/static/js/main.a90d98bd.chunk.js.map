{"version":3,"sources":["img/roll.svg","components/Sliders.js","panels/Home.js","panels/Intro.js","App.js","index.js"],"names":["module","exports","IS_TAPTIC_SUPPORTED","bridge","supports","throttle","callback","delay","args","context","isThrottled","wrapper","arguments","this","apply","setTimeout","Home","fetchedState","snackbarError","useState","hasOwnProperty","rollsCount","setRollsCount","toiletVisits","setToiletVisits","personsCount","setPersonsCount","sheetsCount","SHEETS_PER_ROLL","setSheetsCount","snackbar","setSnackbar","onSheet","a","send","type","layout","onClose","before","size","style","backgroundColor","fill","width","height","duration","newSheetsCount","newRollsCount","Math","floor","setStorage","properties","key","value","JSON","stringify","onRollsChange","rolls","onVisitsChange","visits","onPersonsChange","persons","className","sheetsPerDay","totalSheets","round","countDays","step","min","max","top","indicator","mode","role","aria-label","onChange","vertical","onClick","src","roll","alt","id","Sliders","Intro","go","route","fetchedUser","userHasSeenIntro","centered","photo_200","first_name","level","ROUTES","STORAGE_KEYS","App","activePanel","setActivePanel","setUser","setFetchedState","popout","setPopout","setUserHasSeenIntro","useEffect","user","keys","sheetState","Array","isArray","data","forEach","parse","hasSeenIntro","error","subscribe","detail","schemeAttribute","document","createAttribute","scheme","body","attributes","setNamedItem","fetchData","panel","viewIntro","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.a90d98bd.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/roll.b528eaf8.svg\";","import React, { useState, Fragment } from 'react';\nimport Slider from '@vkontakte/vkui/dist/components/Slider/Slider';\nimport Header from '@vkontakte/vkui/dist/components/Header/Header';\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\nimport FixedLayout from '@vkontakte/vkui/dist/components/FixedLayout/FixedLayout';\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\nimport FormLayout from '@vkontakte/vkui/dist/components/FormLayout/FormLayout';\nimport Counter from '@vkontakte/vkui/dist/components/Counter/Counter';\nimport Snackbar from '@vkontakte/vkui/dist/components/Snackbar/Snackbar';\nimport Icon28DocumentOutline from '@vkontakte/icons/dist/28/document_outline';\nimport bridge from '@vkontakte/vk-bridge';\nimport roll from '../img/roll.svg';\n\nconst SHEETS_PER_ROLL \t\t= 10;\nconst SHEETS_PER_VISIT \t\t= 1;\nconst DEFAULT_ROLLS_COUNT \t= 4;\nconst DEFAULT_TOILET_VISITS = 3;\nconst DEFAULT_PERSONS_COUNT = 2;\nconst IS_TAPTIC_SUPPORTED\t= bridge.supports('VKWebAppTapticNotificationOccurred');\n\nfunction throttle(callback, delay) {\n\tlet isThrottled = false, args, context;\n\n\tfunction wrapper() {\n\t\tif (isThrottled) {\n\t\t\targs = arguments;\n\t\t\tcontext = this;\n\t\t\treturn;\n\t\t}\n\n\t\tisThrottled = true;\n\t\tcallback.apply(this, arguments);\n\t\t\n\t\tsetTimeout(() => {\n\t\t\tisThrottled = false;\n\t\t\tif (args) {\n\t\t\t\twrapper.apply(context, args);\n\t\t\t\targs = context = null;\n\t\t\t}\n\t\t}, delay);\n\t}\n\treturn wrapper;\n}\n\nconst Home = ({ fetchedState, snackbarError }) => {\n\tconst [rollsCount, setRollsCount] = useState(fetchedState.hasOwnProperty('rollsCount') ? fetchedState.rollsCount : DEFAULT_ROLLS_COUNT);\n\tconst [toiletVisits, setToiletVisits] = useState(fetchedState.hasOwnProperty('toiletVisits') ? fetchedState.toiletVisits : DEFAULT_TOILET_VISITS);\n\tconst [personsCount, setPersonsCount] = useState(fetchedState.hasOwnProperty('personsCount') ? fetchedState.personsCount : DEFAULT_PERSONS_COUNT);\n\tconst [sheetsCount, setSheetsCount] = useState(fetchedState.hasOwnProperty('sheetsCount') ? fetchedState.sheetsCount : SHEETS_PER_ROLL * DEFAULT_ROLLS_COUNT);\n\tconst [snackbar, setSnackbar] = useState(snackbarError);\n\n\tconst onSheet = async function () {\n\t\tif (IS_TAPTIC_SUPPORTED) {\n\t\t\tawait bridge.send('VKWebAppTapticNotificationOccurred', { type: sheetsCount <= 0 ? 'error' : 'success' });\n\t\t}\n\t\tif (sheetsCount <= 0) {\n\t\t\tsetSnackbar(<Snackbar\n\t\t\t\tlayout='vertical'\n\t\t\t\tonClose={() => setSnackbar(null)}\n\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon28DocumentOutline fill='#fff' width={14} height={14} /></Avatar>}\n\t\t\t\tduration={900}\n\t\t\t>\n\t\t\t\tУ вас не осталось гречки\n\t\t\t</Snackbar>);\n\t\t\tsetRollsCount(0);\n\t\t\treturn;\n\t\t}\n\t\tconst newSheetsCount = sheetsCount - 1;\n\t\tconst newRollsCount = Math.floor(newSheetsCount / SHEETS_PER_ROLL);\n\n\t\tsetSheetsCount(newSheetsCount);\n\t\tif (rollsCount !== newRollsCount && newRollsCount !== 0) {\n\t\t\tsetRollsCount(newRollsCount);\n\t\t}\n\t\tsetSnackbar(<Snackbar\n\t\t\tlayout='vertical'\n\t\t\tonClose={() => setSnackbar(null)}\n\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--accent)'}}><Icon28DocumentOutline fill='#fff' width={14} height={14} /></Avatar>}\n\t\t\tduration={900}\n\t\t>\n\t\t\t{newSheetsCount <= 0 ? 'У вас не осталось гречки' : `100 грамм гречки потрачено, осталось ${newSheetsCount} приемов пищи`}\n\t\t</Snackbar>);\n\t\tsetStorage({\n\t\t\tsheetsCount: newSheetsCount\n\t\t});\n\t}\n\n\tconst setStorage = async function(properties) {\n\t\tawait bridge.send('VKWebAppStorageSet', {\n\t\t\tkey: 'state',\n\t\t\tvalue: JSON.stringify({\n\t\t\t\trollsCount,\n\t\t\t\ttoiletVisits,\n\t\t\t\tpersonsCount,\n\t\t\t\tsheetsCount,\n\t\t\t\t...properties\n\t\t\t})\n\t\t});\n\t}\n\n\tconst countDays = function() {\n\t\tconst sheetsPerDay = SHEETS_PER_VISIT * toiletVisits * personsCount;\n\t\tconst totalSheets = rollsCount * SHEETS_PER_ROLL\n\t\treturn Math.round(totalSheets / sheetsPerDay);\n\t}\n\n\tconst onRollsChange = throttle(rolls => {\n\t\tif (rolls === rollsCount) return;\n\t\tsetSheetsCount(sheetsCount + (rolls - rollsCount) * SHEETS_PER_ROLL);\n\t\tsetRollsCount(rolls);\n\t\tsetStorage();\n\t}, 200);\n\n\tconst onVisitsChange = throttle(visits => {\n\t\tif (visits === toiletVisits) return;\n\t\tsetToiletVisits(visits)\n\t\tsetStorage();\n\t}, 200);\n\n\tconst onPersonsChange = throttle(persons => {\n\t\tif (persons === personsCount) return;\n\t\tsetPersonsCount(persons);\n\t\tsetStorage();\n\t}, 200);\n\n\treturn (\n\t\t<Fragment>\n\t\t\t<Group>\n\t\t\t\t<h1 className='DaysLeftHeading'>{countDays()}</h1>\n\t\t\t\t<h3 className='DaysLeftSubheading'>Столько дней вы продержитесь</h3>\n\t\t\t</Group>\n\t\t\t<FormLayout>\n\t\t\t\t\t<Slider\n\t\t\t\t\t\tstep={1}\n\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\tmax={100}\n\t\t\t\t\t\tvalue={rollsCount}\n\t\t\t\t\t\ttop={\n\t\t\t\t\t\t\t<Header indicator={<Counter size='m' mode='primary'>{rollsCount}</Counter>}>\n\t\t\t\t\t\t\t\t<span role='img' aria-label='Toilet paper'>🥡</span> Количество пачек\n\t\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonChange={(rolls) => onRollsChange(rolls)}\n\t\t\t\t\t/>\n\t\t\t\t\t<Slider\n\t\t\t\t\t\tstep={1}\n\t\t\t\t\t\tmin={1}\n\t\t\t\t\t\tmax={8}\n\t\t\t\t\t\tvalue={toiletVisits}\n\t\t\t\t\t\ttop={\n\t\t\t\t\t\t\t<Header indicator={<Counter size='m' mode='primary'>{toiletVisits}</Counter>}>\n\t\t\t\t\t\t\t\t<span role='img' aria-label='Poo'>🥣</span> Приемов пищи в день\n\t\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonChange={visits => onVisitsChange(visits)}\n\t\t\t\t\t/>\n\t\t\t\t\t<Slider\n\t\t\t\t\t\tstep={1}\n\t\t\t\t\t\tmin={1}\n\t\t\t\t\t\tmax={16}\n\t\t\t\t\t\tvalue={personsCount}\n\t\t\t\t\t\ttop={\n\t\t\t\t\t\t\t<Header indicator={<Counter size='m' mode='primary'>{personsCount}</Counter>}>\n\t\t\t\t\t\t\t\t<span role='img' aria-label='People in household'>👨‍👩‍👧‍👦</span> Людей дома\n\t\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonChange={persons => onPersonsChange(persons)}\n\t\t\t\t\t/>\n\t\t\t</FormLayout>\n\n\t\t\t<FixedLayout vertical=\"bottom\">\n\t\t\t\t<Div className='PooBtnContainer'>\n\t\t\t\t\t<Button  className='PooBtn' size='xl' onClick={onSheet}>\n\t\t\t\t\t\t<img src={roll} alt=\"Toilet paper roll\"/>\n\t\t\t\t\t</Button>\n\t\t\t\t</Div>\n\t\t\t</FixedLayout>\n\n\t\t\t{snackbar}\n\t\t</Fragment>\n\t);\n};\n\nexport default Home;\n","import React from 'react';\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\nimport Sliders from '../components/Sliders';\n\nimport './Home.css';\n\nconst Home = ({ id, snackbarError, fetchedState }) => {\n\n\treturn (\n\t\t<Panel id={id}>\n\t\t\t<PanelHeader>Гречка</PanelHeader>\n\t\t\t{fetchedState && <Sliders fetchedState={fetchedState} snackbarError={snackbarError} />}\n\t\t</Panel>\n\t);\n};\n\nexport default Home;\n","import React, { Fragment } from 'react';\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\nimport FixedLayout from '@vkontakte/vkui/dist/components/FixedLayout/FixedLayout';\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\n\nimport './Intro.css';\n\nconst Intro = ({ id, go, route, fetchedUser, userHasSeenIntro }) => (\n\t<Panel id={id} centered={true}>\n\t\t<PanelHeader>Гречка</PanelHeader>\n\t\t{(fetchedUser && !userHasSeenIntro) &&\n\t\t\t<Fragment>\n\t\t\t\t<Group>\n\t\t\t\t\t<Div className='User'>\n\t\t\t\t\t\t{fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\n\t\t\t\t\t\t<h2>Привет, {fetchedUser.first_name}</h2>\n\t\t\t\t\t\t<h3>Этот сервис помогает следить за тем, чтобы гречка дома не заканчивалась и ты не попал в неловкую ситуацию, когда ее не окажется в самый нужный момент.</h3>\n\t\t\t\t\t</Div>\n\t\t\t\t</Group>\n\t\t\t\t<FixedLayout vertical='bottom'>\n\t\t\t\t\t<Div>\n\t\t\t\t\t\t<Button mode='commerce' size=\"xl\" level=\"2\" onClick={() => go(route)}>\n\t\t\t\t\t\t\tОК, всё понятно\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Div>\n\t\t\t\t</FixedLayout>\n\t\t\t</Fragment>\n\t\t}\n\t</Panel>\n);\nexport default Intro;\n","import React, { useState, useEffect } from 'react';\nimport bridge from '@vkontakte/vk-bridge';\nimport View from '@vkontakte/vkui/dist/components/View/View';\nimport Snackbar from '@vkontakte/vkui/dist/components/Snackbar/Snackbar';\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\nimport Icon24Error from '@vkontakte/icons/dist/24/error';\n\nimport '@vkontakte/vkui/dist/vkui.css';\n\nimport Home from './panels/Home';\nimport Intro from './panels/Intro';\n\nconst ROUTES = {\n\tHOME: 'home',\n\tINTRO: 'intro',\n};\n\nconst STORAGE_KEYS = {\n\tSTATE: 'state',\n\tSTATUS: 'viewStatus',\n};\n\nconst App = () => {\n\tconst [activePanel, setActivePanel] = useState(ROUTES.INTRO);\n\tconst [fetchedUser, setUser] = useState(null);\n\tconst [fetchedState, setFetchedState] = useState(null);\n\tconst [snackbar, setSnackbar] = useState(null);\n\tconst [popout, setPopout] = useState(<ScreenSpinner size='large' />);\n\tconst [userHasSeenIntro, setUserHasSeenIntro] = useState(false);\n\n\tuseEffect(() => {\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t});\n\t\tasync function fetchData() {\n\t\t\tconst user = await bridge.send('VKWebAppGetUserInfo');\n\t\t\tconst sheetState = await bridge.send('VKWebAppStorageGet', { keys: [STORAGE_KEYS.STATE, STORAGE_KEYS.STATUS]});\n\t\t\tif (Array.isArray(sheetState.keys)) {\n\t\t\t\tconst data = {};\n\t\t\t\tsheetState.keys.forEach(({ key, value }) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[key] = value ? JSON.parse(value) : {};\n\t\t\t\t\t\tswitch (key) {\n\t\t\t\t\t\t\tcase STORAGE_KEYS.STATE:\n\t\t\t\t\t\t\t\tsetFetchedState(data[STORAGE_KEYS.STATE]);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase STORAGE_KEYS.STATUS:\n\t\t\t\t\t\t\t\tif (data[key] && data[key].hasSeenIntro) {\n\t\t\t\t\t\t\t\t\tsetActivePanel(ROUTES.HOME);\n\t\t\t\t\t\t\t\t\tsetUserHasSeenIntro(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tsetSnackbar(<Snackbar\n\t\t\t\t\t\t\tlayout='vertical'\n\t\t\t\t\t\t\tonClose={() => setSnackbar(null)}\n\t\t\t\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--dynamic_red)'}}><Icon24Error fill='#fff' width={14} height={14} /></Avatar>}\n\t\t\t\t\t\t\tduration={900}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tПроблема с получением данных из Storage\n\t\t\t\t\t\t</Snackbar>\n\t\t\t\t\t\t);\n\t\t\t\t\t\tsetFetchedState({});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tsetFetchedState({});\n\t\t\t}\n\t\t\tsetUser(user);\n\t\t\tsetPopout(null);\n\t\t}\n\t\tfetchData();\n\t}, []);\n\n\tconst go = panel => {\n\t\tsetActivePanel(panel);\n\t};\n\n\tconst viewIntro = async (panel) => {\n\t\ttry {\n\t\t\tawait bridge.send('VKWebAppStorageSet', {\n\t\t\t\tkey: STORAGE_KEYS.STATUS,\n\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\thasSeenIntro: true,\n\t\t\t\t}),\n\t\t\t});\n\t\t\tgo(panel);\n\t\t} catch (error) {\n\t\t\tsetSnackbar(<Snackbar\n\t\t\t\tlayout='vertical'\n\t\t\t\tonClose={() => setSnackbar(null)}\n\t\t\t\tbefore={<Avatar size={24} style={{backgroundColor: 'var(--dynamic_red)'}}><Icon24Error fill='#fff' width={14} height={14} /></Avatar>}\n\t\t\t\tduration={900}\n\t\t\t>\n\t\t\t\tПроблема с отправкой данных в Storage\n\t\t\t</Snackbar>\n\t\t\t);\n\t\t}\n\t}\n\n\treturn (\n\t\t<View activePanel={activePanel} popout={popout}>\n\t\t\t<Home id={ROUTES.HOME} fetchedState={fetchedState} snackbarError={snackbar} />\n\t\t\t<Intro id={ROUTES.INTRO} fetchedUser={fetchedUser} go={viewIntro} route={ROUTES.HOME} userHasSeenIntro={userHasSeenIntro} />\n\t\t</View>\n\t);\n}\n\nexport default App;\n\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n"],"sourceRoot":""}